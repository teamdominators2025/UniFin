<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIFIN CallShield | Dominators Edition</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --safe: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --glass: rgba(255, 255, 255, 0.9);
        }

        body {
            margin: 0; padding: 20px;
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            color: #1e293b; overflow: hidden;
            background: #f8fafc;
        }

        /* Colourful Animated Background */
        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
        }
        .blob {
            position: absolute; width: 600px; height: 600px;
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            filter: blur(80px); border-radius: 50%; opacity: 0.3;
            animation: move 25s infinite alternate;
        }
        .blob2 {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            right: -100px; top: -100px; animation-duration: 18s;
        }
        @keyframes move {
            from { transform: translate(-10%, -10%); }
            to { transform: translate(20%, 20%); }
        }

        .container {
            background: var(--glass);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 32px; padding: 40px;
            width: 100%; max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            text-align: center; z-index: 10;
        }

        .threat-pulse { animation: pulse-danger 1.5s infinite; }
        @keyframes pulse-danger {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5); }
            70% { box-shadow: 0 0 0 25px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        h1 {
            font-size: 2.2rem; margin-bottom: 0px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .team-credit {
            font-size: 0.7rem; text-transform: uppercase;
            letter-spacing: 2px; color: #64748b; margin-bottom: 20px; display: block;
        }

        /* Waveform Canvas */
        #visualizer {
            width: 100%; height: 60px;
            margin-bottom: 20px; border-radius: 12px;
            display: none;
        }

        button {
            padding: 14px 28px; border-radius: 16px; border: none;
            font-weight: 700; cursor: pointer; transition: 0.3s; margin: 5px;
        }
        #startBtn { background: var(--primary); color: white; }
        #downloadBtn { background: #fff; border: 1px solid #e2e8f0; display: none; }

        .track { height: 12px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin: 15px 0; }
        #riskBar { width: 0%; height: 100%; background: var(--safe); transition: 0.8s ease; }

        #transcript {
            background: rgba(255, 255, 255, 0.6); padding: 15px;
            border-radius: 18px; text-align: left; font-size: 0.9rem;
            height: 60px; overflow-y: auto; border: 1px solid #eef2f6; margin-bottom: 15px;
        }

        #recommendations {
            display: none; text-align: left; padding: 20px;
            border-radius: 18px; background: #fff; border: 1px solid #e2e8f0;
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="bg-animation">
    <div class="blob"></div>
    <div class="blob blob2"></div>
</div>

<div class="container" id="mainContainer">
    <h1>UNIFIN CallShield</h1>
    <span class="team-credit">by team dominators</span>

    <canvas id="visualizer"></canvas>

    <div class="btn-group">
        <button id="startBtn">Start Monitoring</button>
        <button id="downloadBtn">Download Report</button>
    </div>

    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: bold;">
        <span>THREAT LEVEL</span>
        <span id="riskLabel">0%</span>
    </div>
    <div class="track"><div id="riskBar"></div></div>

    <div id="transcript">Awaiting audio...</div>

    <div id="recommendations">
        <strong id="recTitle" style="display: block; margin-bottom: 10px;">üõ°Ô∏è Safety Recommendations:</strong>
        <div id="recList"></div>
    </div>
</div>

<script>
    const startBtn = document.getElementById('startBtn');
    const visualizer = document.getElementById('visualizer');
    const ctx = visualizer.getContext('2d');
    const riskBar = document.getElementById('riskBar');
    const riskLabel = document.getElementById('riskLabel');
    const recPanel = document.getElementById('recommendations');
    const mainContainer = document.getElementById('mainContainer');

    let fullTranscript = "";
    let finalResultStatus = "";

    // Speech & Audio Visualizer Logic
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;

    startBtn.onclick = async () => {
        recognition.start();
        startBtn.innerText = "Monitoring...";
        startBtn.disabled = true;
        visualizer.style.display = "block";
        setupVisualizer();
    };

    async function setupVisualizer() {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioCtx.createAnalyser();
        const source = audioCtx.createMediaStreamSource(stream);
        source.connect(analyser);
        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        function draw() {
            requestAnimationFrame(draw);
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, visualizer.width, visualizer.height);
            const barWidth = (visualizer.width / bufferLength) * 2.5;
            let x = 0;
            for(let i = 0; i < bufferLength; i++) {
                const barHeight = dataArray[i] / 5;
                ctx.fillStyle = `rgba(99, 102, 241, ${barHeight / 20})`;
                ctx.fillRect(x, visualizer.height - barHeight, barWidth, barHeight);
                x += barWidth + 1;
            }
        }
        draw();
    }

    recognition.onresult = (event) => {
        let currentText = "";
        for (let i = 0; i < event.results.length; i++) {
            currentText += event.results[i][0].transcript;
        }
        fullTranscript = currentText;
        document.getElementById('transcript').innerText = currentText;
        analyze(currentText.toLowerCase());
    };

    function analyze(text) {
        const triggers = { "bank account": 25, "expired": 15, "details": 10, "gift card": 35, "password": 30 };
        let score = 0;
        for (let key in triggers) { if (text.includes(key)) score += triggers[key]; }
        score = Math.min(score, 100);

        riskBar.style.width = score + "%";
        riskLabel.innerText = score + "%";
        document.getElementById('downloadBtn').style.display = "inline-block";

        if (score >= 20) {
            recPanel.style.display = "block";
            updateTips(score);
        }

        if (score >= 60) {
            finalResultStatus = "‚ùå DANGER: High probability of scam detected.";
            riskBar.style.background = "var(--danger)";
            mainContainer.classList.add('threat-pulse');
        } else if (score >= 20) {
            finalResultStatus = "‚ö†Ô∏è CAUTION: Suspicious language detected.";
            riskBar.style.background = "var(--warning)";
            mainContainer.classList.remove('threat-pulse');
        } else {
            finalResultStatus = "‚úÖ SAFE: No immediate threats identified.";
            riskBar.style.background = "var(--safe)";
            mainContainer.classList.remove('threat-pulse');
            recPanel.style.display = "none";
        }
    }

    function updateTips(score) {
        let tips = score >= 60 ? 
            ["üö´ Hang up immediately!", "üìû Call your bank via their official app.", "üõë Don't share OTPs."] :
            ["üßê Ask for their employee ID.", "‚öñÔ∏è Don't be rushed.", "üîç Verify independently."];
        
        document.getElementById('recList').innerHTML = tips.map(t => `<p style="font-size:0.85rem; margin:5px 0;">${t}</p>`).join("");
        document.getElementById('recTitle').style.color = score >= 60 ? "var(--danger)" : "var(--warning)";
    }

    document.getElementById('downloadBtn').onclick = () => {
        const now = new Date();
        const report = `CALLSHIELD THREAT REPORT\n------------------------\nDate: ${now.toLocaleDateString('en-GB')}, ${now.toLocaleTimeString()}\nRisk Level: ${riskLabel.innerText}\nResult: ${finalResultStatus}\n\nFULL TRANSCRIPT:\n"${fullTranscript}"\n\n------------------------\nGenerated by UNIFIN CallShield\nby team dominators`;
        const blob = new Blob([report], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `CallShield_Report.txt`;
        a.click();
    };
</script>
</body>
</html>